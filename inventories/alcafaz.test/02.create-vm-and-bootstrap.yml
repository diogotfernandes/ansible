---
- hosts: localhost
  become: false
  gather_facts: False
  roles:
    - kvm
  vars:
    kvm_base_vm: debian10	## CHANGE ME!
    host:
      name: web01.alcafaz.test		  ## CHANGE ME!
      ip: '192.168.100.11'		      ## CHANGE ME!
      network: alcafaz.test		      ## CHANGE ME!
      inventory_group: webservers
      add_to_inventory: True
    kvm_name: "{{ host.name }}"

  tasks:
    ## Wait for vm start
    - name: Sleep for 25 seconds and continue with play
      wait_for:
        timeout: 25 # 25 seconds
      delegate_to: localhost
      tags: always

- hosts: test.alcafaz.test			## CHANGE ME!
  gather_facts: True
  roles:
    - bootstrap

  vars:
    ansible_user: root
    bootstrap_hostname:
      name: test
      domain: alcafaz.test



  # post_tasks:
   ## por exemplo enviar email a avisar que a nova máquina está pronta!

#
# Variáveis com  'CHANGE ME!' devem ser alteradas, de acordo com o host a configurar.
#
# ansible-playbook 01.create_vm_and_initial_config.yml --tags "create_vm, add_ip, start, packages, hostname, ssh, timezone, ufw, user, dhcp_config" -i inventories/alcafaz.test/hosts
